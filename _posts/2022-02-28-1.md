---
layout: post
title: Creating component dynamically into a directive with Angular
subject: Dev
keywords: Angular, Angular2+, TypeScript, component, directive, dynamically, dynamic component
---

You can use programmatic method to create component dynamically in Angular.
In this post, we will learn about the dynamic component creation of Angular using `ViewContainerRef`.

# Prerequisite

- Angular 13.2.0 

This approach may work with older versions of Angular as well.
But I'm not sure.

# ViewContainerRef

This is a reference to the container which can attach one or more components in it.
You can inject this to a component or directive and
use `createComponent()` method to create component dynamically.
See [ViewContainerRef](https://angular.io/api/core/ViewContainerRef){:target="_blank" rel="nofollow noopener noreferrer"}.

```typescript
@Component({
  selector: 'app-test-component',
  templateUrl: './test-component.component.html',
  styleUrls: ['./test-component.component.scss'],
})
export class TestComponent implements OnInit, AfterViewInit {
}

@Directive({
  selector: '[appTestDirective]',
})
export class TestDirective {
  constructor(
    private viewContainerRef: ViewContainerRef,
  ) {
  }
  
  @HostListener('click')
  onHostClicked(): void {
    this.viewContainerRef.createComponent(TestComponent);
  }
}
```

From above codes, if a user click `TestDirective`, the `TestComponent` will be created dynamically into a `ViewContainerRef`.
But it won't be created in a `TestDirective`.
The `ViewContainerRef` injected in `TestDirective` normally represents a parent of the `TestDirective`.
This isn't correct way to create a component ***in*** a directive.

# Renderer2 and ComponentRef

To make it work, you need to use `Renderer2`.
The `Renderer2` has `appendChild()` method which is similar to `document.appendChild()` method.
See more details from [Renderer2#appendChild](https://angular.io/api/core/Renderer2#appendChild){:target="_blank" rel="nofollow noopener noreferrer"}.

The `ViewContainerRef.createComponent()` method returns `ComponentRef` which reference to a component,
and the `ComponentRef` has `location` getter which returns `ElementRef` of the created component.
See [ComponentRef#location](https://angular.io/api/core/ComponentRef#location){:target="_blank" rel="nofollow noopener noreferrer"}.

So, you can combine these 2 things to create component dynamically into a directive.

```typescript
@Directive({
  selector: '[appTestDirective]',
})
export class TestDirective {
  constructor(
    private renderer: Renderer2,
    private elementRef: ElementRef,
    private viewContainerRef: ViewContainerRef,
  ) {
  }
  
  @HostListener('click')
  onHostClicked(): void {
    const componentRef = this.viewContainerRef.createComponent(TestComponent);
    
    this.renderer.appendChild(
      this.elementRef.nativeElement,
      componentRef.location.nativeElement,
    );
  }
}
```

Now everything will work fine.
You can use this code like below.

```html
<button appTestDirective>
  Button
</button>
```

The user can append `TestComponent` into the button by clicking it.
